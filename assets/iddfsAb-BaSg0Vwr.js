const k=Array(64).fill(null);k[27]="w";k[28]="b";k[35]="b";k[36]="w";const P=[100,-25,10,5,5,10,-25,100,-25,-25,1,1,1,1,-25,-25,10,1,5,2,2,5,1,10,5,1,2,1,1,2,1,5,5,1,2,1,1,2,1,5,10,1,5,2,2,5,1,10,-25,-25,1,1,1,1,-25,-25,100,-25,10,5,5,10,-25,100],A=[-9,-8,-7,-1,1,7,8,9],T=5e3;function S(n,e,t){if(e<0||e>=64||n[e])return[];const s=t==="b"?"w":"b",o=[];for(const c of A){const f=[];let i=e+c;if(!(Math.abs(e%8-i%8)>1))for(;i>=0&&i<64&&!(Math.abs(i%8-(i-c)%8)>1);){const u=n[i];if(u===s)f.push(i);else if(u===t){o.push(...f);break}else break;i+=c}}return o}function g(n,e){for(let t=0;t<64;t++)if(n[t]===null&&S(n,t,e).length>0)return!1;return!0}function B(n){return n.reduce((e,t)=>(t==="b"?e.black++:t==="w"&&e.white++,e),{black:0,white:0})}function b(n,e){const t=e==="b"?"w":"b";let s=0,o=0;for(let c=0;c<64;c++)n[c]===e?s+=P[c]:n[c]===t&&(o+=P[c]);return s-o}function D(n,e){const t=[];for(let s=0;s<64;s++){const o=S(n,s,e);o.length>0&&t.push({move:s,piecesToFlip:o})}return t}function v(n,e,t,s,o,c,f){const i=performance.now(),{black:u,white:w}=B(n),l=e==="b"?"w":"b",I=g(n,e),p=g(n,l);if(f&&i-f>T||t===0||u+w===64||I&&p)return b(n,c);if(I)return v(n,l,t-1,s,o,c,f);const r=e===c;let h=r?-1/0:1/0;for(let M=0;M<64;M++){const m=S(n,M,e);if(m.length>0){n[M]=e,m.forEach(E=>n[E]=e);const F=v(n,l,t-1,s,o,c,f);if(n[M]=null,m.forEach(E=>n[E]=l),r){if(h=Math.max(h,F),s=Math.max(s,h),o<=s)break}else if(h=Math.min(h,F),o=Math.min(o,h),o<=s)break}if(r&&o<=s)break}return h}function L(n,e,t,s=3){const o=t==="b"?"w":"b",c={};return e.forEach(({move:f,piecesToFlip:i})=>{n[f]=t,i.forEach(u=>n[u]=t),c[f]=v(n,o,s,-1/0,1/0,t),n[f]=null,i.forEach(u=>n[u]=o)}),e.sort((f,i)=>c[i.move]-c[f.move]),e[0]}function N(n,e,t){const s=e==="b"?"w":"b",o=D(n,e);if(o.length===0)return-1;let c=L(n,o,e).move;for(let f=1;f<64;f++){let i=-1/0;const u=1/0;let w=-1;for(const{move:l,piecesToFlip:I}of o){if(performance.now()-t>=T){w=-1;break}n[l]=e,I.forEach(r=>n[r]=e);const p=v(n,s,f,i,u,e,t);n[l]=null,I.forEach(r=>n[r]=s),p>i&&(i=p,w=l)}if(performance.now()-t<T)c=w;else break}return c}self.onmessage=n=>{const{board:e,player:t}=n.data,s=performance.now(),o=N(e,t,s);self.postMessage(o)};
